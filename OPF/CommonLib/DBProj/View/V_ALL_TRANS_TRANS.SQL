CREATE OR REPLACE VIEW V_ALL_TRANS_TRANS AS
SELECT T_TRANSPORT_STOCK.ISSUE_PLANT_CD AS ISSUE_PLANT_CD,
       PLANT1.PLANT_NAME AS ISSUE_PLANT_NAME,
       T_TRANSPORT_STOCK.ISSUE_WH_CD AS ISSUE_WH_CD,
       WH1.WH_NAME AS ISSUE_WH_NAME,
       T_TRANSPORT_STOCK.ITEM_CD AS ITEM_CD,
       M_ITEM.ITEM_NAME AS ITEM_NAME,
       T_TRANSPORT_STOCK.JOB_ODR_CD AS JOB_ODR_CD,
       T_TRANSPORT_STOCK.RCV_PLANT_CD AS RCV_PLANT_CD,
       PLANT2.PLANT_NAME AS RCV_PLANT_NAME,
       T_TRANSPORT_STOCK.RCV_WH_CD AS RCV_WH_CD,
       WH2.WH_NAME AS RCV_WH_NAME,
       TO_CHAR((T_TRANSPORT_STOCK.ISSUE_QTY - T_TRANSPORT_STOCK.RCV_QTY),
               'fm99999999999990.0999') AS TRANSPORT_QTY,
       M_ITEM.STOCK_UNIT AS STOCK_UNIT,
       M_ITEM.ABC_TYP AS ABC_TYP,
       TO_CHAR(T_INV_CTRL.INV_DATE,'YYYY/MM/DD') AS INV_DATE,
       T_TRANSPORT_STOCK.Lot_No
  FROM T_TRANSPORT_STOCK,
       M_PLANT PLANT1,
       M_PLANT PLANT2,
       M_ITEM,
       M_WH WH1,
       M_WH WH2,
       T_INV_CTRL
 WHERE T_TRANSPORT_STOCK.ISSUE_WH_CD = WH1.WH_CD
   AND T_TRANSPORT_STOCK.RCV_WH_CD = WH2.WH_CD
   AND T_TRANSPORT_STOCK.ITEM_CD = M_ITEM.ITEM_CD
   AND M_ITEM.ABC_TYP <> 9
   AND M_ITEM.MRP_ODR_TYP <> 8
   AND T_TRANSPORT_STOCK.ISSUE_PLANT_CD = PLANT1.PLANT_CD
   AND T_TRANSPORT_STOCK.RCV_PLANT_CD = PLANT2.PLANT_CD
   AND T_INV_CTRL.PLANT_CD = T_TRANSPORT_STOCK.ISSUE_PLANT_CD
   AND T_TRANSPORT_STOCK.TRANSPORT_CMPLT_TYP = 0
   AND T_TRANSPORT_STOCK.ITEM_CD IN
       (SELECT T_INV_CYCLE.ITEM_CD
         FROM T_INV_CYCLE
         WHERE T_INV_CYCLE.PLANT_CD = T_TRANSPORT_STOCK.ISSUE_PLANT_CD
         AND DECODE(TO_CHAR(T_INV_CTRL.INV_DATE,'MM'),'01',T_INV_CYCLE.INV_FLG_JAN,
                                                        '02',T_INV_CYCLE.INV_FLG_FEB,
                                                        '03',T_INV_CYCLE.INV_FLG_MAR,
                                                        '04',T_INV_CYCLE.INV_FLG_APR,
                                                        '05',T_INV_CYCLE.INV_FLG_MAY,
                                                        '06',T_INV_CYCLE.INV_FLG_JUN,
                                                        '07',T_INV_CYCLE.INV_FLG_JUL,
                                                        '08',T_INV_CYCLE.INV_FLG_AUG,
                                                        '09',T_INV_CYCLE.INV_FLG_SEP,
                                                        '10',T_INV_CYCLE.INV_FLG_OCT,
                                                        '11',T_INV_CYCLE.INV_FLG_NOV,
                                                        '12',T_INV_CYCLE.INV_FLG_DEC) = 1)
  UNION
SELECT T_TRANSPORT_STOCK.ISSUE_PLANT_CD AS ISSUE_PLANT_CD,
       PLANT1.PLANT_NAME AS ISSUE_PLANT_NAME,
       T_TRANSPORT_STOCK.ISSUE_WH_CD AS ISSUE_WH_CD,
       WH1.WH_NAME AS ISSUE_WH_NAME,
       T_TRANSPORT_STOCK.ITEM_CD AS ITEM_CD,
       M_ITEM.ITEM_NAME AS ITEM_NAME,
       T_TRANSPORT_STOCK.JOB_ODR_CD AS JOB_ODR_CD,
       T_TRANSPORT_STOCK.RCV_PLANT_CD AS RCV_PLANT_CD,
       PLANT2.PLANT_NAME AS RCV_PLANT_NAME,
       T_TRANSPORT_STOCK.RCV_WH_CD AS RCV_WH_CD,
       WH2.WH_NAME AS RCV_WH_NAME,
       TO_CHAR((T_TRANSPORT_STOCK.ISSUE_QTY - T_TRANSPORT_STOCK.RCV_QTY),
               'fm99999999999990.0999') AS TRANSPORT_QTY,
       M_ITEM.STOCK_UNIT AS STOCK_UNIT,
       M_ITEM.ABC_TYP AS ABC_TYP,
       TO_CHAR(T_INV_CTRL.INV_DATE,'YYYY/MM/DD') AS INV_DATE,
       T_TRANSPORT_STOCK.Lot_No
  FROM T_TRANSPORT_STOCK,
       M_PLANT PLANT1,
       M_PLANT PLANT2,
       M_ITEM,
       M_WH WH1,
       M_WH WH2,
       T_INV_CTRL
 WHERE T_TRANSPORT_STOCK.ISSUE_WH_CD = WH1.WH_CD
   AND T_TRANSPORT_STOCK.RCV_WH_CD = WH2.WH_CD
   AND T_TRANSPORT_STOCK.ITEM_CD = M_ITEM.ITEM_CD
   AND M_ITEM.ABC_TYP <> 9
   AND M_ITEM.MRP_ODR_TYP <> 8
   AND T_TRANSPORT_STOCK.ISSUE_PLANT_CD = PLANT1.PLANT_CD
   AND T_TRANSPORT_STOCK.RCV_PLANT_CD = PLANT2.PLANT_CD
    AND T_INV_CTRL.PLANT_CD = T_TRANSPORT_STOCK.ISSUE_PLANT_CD
   AND T_TRANSPORT_STOCK.TRANSPORT_CMPLT_TYP = 0
   AND ((T_TRANSPORT_STOCK.ISSUE_WH_CD IN
       (SELECT T_INV_TARGET_WH.WH_CD
            FROM T_INV_TARGET_WH
           WHERE TO_CHAR(T_INV_TARGET_WH.INV_DATE,'YYYY/MM/DD') = TO_CHAR(T_INV_CTRL.INV_DATE, 'YYYY/MM/DD')
             AND T_INV_TARGET_WH.PLANT_CD =  T_TRANSPORT_STOCK.ISSUE_PLANT_CD)) OR
       (T_TRANSPORT_STOCK.ITEM_CD IN
       (SELECT T_INV_TARGET_ITEM.ITEM_CD
            FROM T_INV_TARGET_ITEM
           WHERE TO_CHAR(T_INV_TARGET_ITEM.INV_DATE,'YYYY/MM/DD') = TO_CHAR(T_INV_CTRL.INV_DATE, 'YYYY/MM/DD')
             AND T_INV_TARGET_ITEM.PLANT_CD = T_TRANSPORT_STOCK.ISSUE_PLANT_CD)))
/