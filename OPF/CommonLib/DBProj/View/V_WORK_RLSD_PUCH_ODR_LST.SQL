CREATE OR REPLACE VIEW V_WORK_RLSD_PUCH_ODR_LST
as
select
  T_RLSD_PUCH_ODR."PUCH_ODR_CD" as "PUCH_ODR_CD",
  T_RLSD_PUCH_ODR."PLANT_CD" as "PLANT_CD",
  M_PLANT."PLANT_NAME" as "PLANT_NAME",
  T_RLSD_PUCH_ODR."WH_CD" as "WH_CD",
  M_WH."WH_NAME" as "WH_NAME",
  T_RLSD_PUCH_ODR."ITEM_CD" as "ITEM_CD",
  decode(T_RLSD_PUCH_ODR."NON_NO_ITEM_FLG", 0, M_ITEM."ITEM_NAME", T_RLSD_PUCH_ODR."NON_NO_ITEM_NAME") as "ITEM_NAME",
  T_RLSD_PUCH_ODR."COMPANY_CD" as "COMPANY_CD",
  T_RLSD_PUCH_ODR."VEND_CD" as "VEND_CD",
  M_VEND_CTRL."VEND_ANAME" as "VEND_ANAME",
  M_VEND_CTRL."VEND_NAME" as "VEND_NAME",
  T_RLSD_PUCH_ODR."PUCH_ODR_PERSON" as "PUCH_ODR_PERSON",
  USER_MST."USER_NAME" as "USER_NAME",
  T_RLSD_PUCH_ODR."PUCH_ODR_START_DATE",
  T_RLSD_PUCH_ODR."PUCH_ODR_DLV_DATE",
  T_RLSD_PUCH_ODR."PUCH_ODR_QTY",
  decode(T_RLSD_PUCH_ODR."NON_NO_ITEM_FLG", 0, M_ITEM."STOCK_UNIT", T_RLSD_PUCH_ODR."NON_NO_ITEM_PUCH_ODR_UNIT") as "STOCK_UNIT",
  to_char(T_RLSD_PUCH_ODR."UNIT_COST_TYP") as "UNIT_COST_TYP",
  T3."DISPLAY_NAME" as "UNIT_COST_TYP_DN",
  T_RLSD_PUCH_ODR."UNIT_COST",
  T_RLSD_PUCH_ODR."PUCH_ODR_AMOUNT",
  M_CUR."CUR_UNIT" as "VEND_CUR_UNIT",
  T_RLSD_PUCH_ODR."DISC_AMOUNT",
  T_RLSD_PUCH_ODR."NET_AMOUNT",
  T_RLSD_PUCH_ODR."TAX_AMOUNT_1",
  T_RLSD_PUCH_ODR."TAX_AMOUNT_2",
  T_RLSD_PUCH_ODR."TAX_AMOUNT_3",
  T_RLSD_PUCH_ODR."AMOUNT_INCLUDE_TAX",
  T_RLSD_PUCH_ODR."RATE_JUDGE_DATE",
  T_RLSD_PUCH_ODR."EXCH_RATE",
  T_RLSD_PUCH_ODR."HOME_CUR_AMOUNT",
  M_CUR2."CUR_UNIT" as "HOME_CUR_UNIT",
  T_RLSD_PUCH_ODR."PUCH_ODR_INST_DATE",
  to_char(T_RLSD_PUCH_ODR."PUCH_ODR_INST_SLIP_ISS_FLG") as "PUCH_ODR_INST_SLIP_ISS_FLG",
  T4."DISPLAY_NAME" as "PUCH_ODR_INST_SLIP_ISS_FLG_DN",
  T_RLSD_PUCH_ODR."PUCH_ODR_SLIP_ISS_DATE",
  to_char(T_RLSD_PUCH_ODR."PUCH_ODR_STS_TYP") as "PUCH_ODR_STS_TYP",
  T5."DISPLAY_NAME" as "PUCH_ODR_STS_TYP_DN",
  to_char(T_RLSD_PUCH_ODR."INSPC_CMPLT_FLG") as "INSPC_CMPLT_FLG",
  T6."DISPLAY_NAME" as "INSPC_CMPLT_FLG_DN",
  T_RLSD_PUCH_ODR."INSPC_CMPLT_DATE",
  T_RLSD_PUCH_ODR."CONFIRM_DLV_DATE",
  to_char(T_RLSD_PUCH_ODR."SPL_ITEM_TYP") as "SPL_ITEM_TYP",
  T7."DISPLAY_NAME" as "SPL_ITEM_TYP_DN",
  to_char(T_RLSD_PUCH_ODR."ACPT_INSPC_TYP") as "ACPT_INSPC_TYP",
  T8."DISPLAY_NAME" as "ACPT_INSPC_TYP_DN",
  to_char(T_RLSD_PUCH_ODR."INV_CTRL_FLG") as "INV_CTRL_FLG",
  T9."DISPLAY_NAME" as "INV_CTRL_FLG_DN",
  T_RLSD_PUCH_ODR."WORK_ODR_CD" as "WORK_ODR_CD",
  T_RLSD_PUCH_ODR."OD_NO" as "OD_NO",
  T_OD."JOB_ODR_CD" as "JOB_ODR_CD",
  T_RLSD_PUCH_ODR."PUCH_ODR_COMMENT" as "PUCH_ODR_COMMENT",
  T_RLSD_PUCH_ODR."ODR_CD" as "ODR_CD",
  to_char(T_RLSD_PUCH_ODR."DETAIL_NO") as "DETAIL_NO",
  to_char(T_RLSD_PUCH_ODR."NON_NO_ITEM_FLG") as "NON_NO_ITEM_FLG",
  T10."DISPLAY_NAME" as "NON_NO_ITEM_FLG_DN",
  decode(T_RLSD_PUCH_ODR."NON_NO_ITEM_FLG", 0, M_ITEM."DRAW_CD", NULL) as "DRAW_CD",
  decode(T_RLSD_PUCH_ODR."NON_NO_ITEM_FLG", 0, M_ITEM."SPEC", NULL) as "SPEC",
  to_char(decode(T_RLSD_PUCH_ODR."NON_NO_ITEM_FLG", 0, M_ITEM."MRP_ODR_TYP", NULL)) as "MRP_ODR_TYP",
  decode(T_RLSD_PUCH_ODR."NON_NO_ITEM_FLG", 0, T11."DISPLAY_NAME", NULL) as "MRP_ODR_TYP_DN",
  NVL(T1."ACPT_QTY",0) as "ACPT_QTY",
  T_RLSD_PUCH_ODR."ACPT_CMPLT_DATE",
  NVL(T2."INSPECTED_QTY", 0) as "INSPECTED_QTY",
  NVL(T2."ACCEPTED_QTY", 0) as "ACCEPTED_QTY",
  T_RLSD_PUCH_ODR."PUCH_ODR_EDI_ISS_DATE",
  T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG,
  T1.PUCH_ODR_CD as EXISTS_CD,
  T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_DATE,
  T_RLSD_PUCH_ODR.CONFIRM_DLV_DATE_COMMENT,
  T12."DISPLAY_NAME" as ODR_CANCEL_SLIP_ISS_FLG_DN,
  T_RLSD_PUCH_ODR.ODR_CANCEL_EDI_ISS_DATE,
  T_RLSD_PUCH_ODR.ODR_CANCEL_CAUSE_CD,
  (CASE WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 1 
		THEN 1
  		WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 2
			AND T_RLSD_PUCH_ODR.PUCH_ODR_INST_SLIP_ISS_FLG = 0
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 0
			AND T1."PUCH_ODR_CD" IS NULL
		THEN 2
  		WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 2
			AND T_RLSD_PUCH_ODR.PUCH_ODR_INST_SLIP_ISS_FLG = 1
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 0
			AND T1."PUCH_ODR_CD" IS NULL
		THEN 3
  		WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 2
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 0
			AND T1."PUCH_ODR_CD" IS NOT NULL
		THEN 4
  		WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 9
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 1
		THEN 5
  		WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 9
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 2
		THEN 6
  		WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 9
			AND T_RLSD_PUCH_ODR.INSPC_CMPLT_FLG = 1
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 0
			AND T_RLSD_PUCH_ODR.ACPT_INSPC_TYP = 1
		THEN 7
  		WHEN T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = 9
			AND T_RLSD_PUCH_ODR.INSPC_CMPLT_FLG = 0
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 0
			AND T_RLSD_PUCH_ODR.ACPT_INSPC_TYP = 2
		THEN 7
  		WHEN T_RLSD_PUCH_ODR.INSPC_CMPLT_FLG = 1
			AND T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = 0
			AND T_RLSD_PUCH_ODR.ACPT_INSPC_TYP = 2
		THEN 8
  ELSE NULL END) as STATUS,
  T_RLSD_PUCH_ODR.DIRECT_FLG AS "DIRECT_FLG"
from
  T_RLSD_PUCH_ODR,
  M_PLANT,
  M_WH,
  M_ITEM,
  M_VEND_CTRL,
  USER_MST,
  M_CUR M_CUR,
  M_CUR M_CUR2,
  SYS_HOME_CUR,
  T_OD,
  (
    select
      T_ACPT_RSLT."PUCH_ODR_CD" as "PUCH_ODR_CD",
      sum(T_ACPT_RSLT."ACPT_QTY") as "ACPT_QTY"
    from
      T_ACPT_RSLT
    group by
      T_ACPT_RSLT.PUCH_ODR_CD
  ) T1,
  (
    select
      T_INSPC_RSLT."PUCH_ODR_CD" as "PUCH_ODR_CD",
      sum(T_INSPC_RSLT."INSPECTED_QTY") as "INSPECTED_QTY",
      sum(T_INSPC_RSLT."ACCEPTED_QTY") as "ACCEPTED_QTY"
    from
      T_INSPC_RSLT
    group by
      T_INSPC_RSLT.PUCH_ODR_CD
  ) T2,
  SYS_TYPE_VALUE T3,
  SYS_TYPE_VALUE T4,
  SYS_TYPE_VALUE T5,
  SYS_TYPE_VALUE T6,
  SYS_TYPE_VALUE T7,
  SYS_TYPE_VALUE T8,
  SYS_TYPE_VALUE T9,
  SYS_TYPE_VALUE T10,
  SYS_TYPE_VALUE T11,
  SYS_TYPE_VALUE T12  
where
  SYS_HOME_CUR.CTRL_CD = 'SYSTEM'
  and M_CUR.CUR_CD = nvl(M_VEND_CTRL.CUR_CD, SYS_HOME_CUR.HOME_CUR_CD)
  and M_CUR2.CUR_CD = SYS_HOME_CUR.HOME_CUR_CD
  and T_RLSD_PUCH_ODR.PLANT_CD = M_PLANT.PLANT_CD
  and T_RLSD_PUCH_ODR.WH_CD = M_WH.WH_CD(+)
  and T_RLSD_PUCH_ODR.ITEM_CD = M_ITEM.ITEM_CD(+)
  and T_RLSD_PUCH_ODR.COMPANY_CD = M_VEND_CTRL.COMPANY_CD(+)
  and T_RLSD_PUCH_ODR.VEND_CD = M_VEND_CTRL.VEND_CD(+)
  and T_RLSD_PUCH_ODR.PUCH_ODR_PERSON = USER_MST.USER_CD(+)
  and T_RLSD_PUCH_ODR.OD_NO = T_OD.OD_NO(+)
  and T_RLSD_PUCH_ODR.PUCH_ODR_CD = T1.PUCH_ODR_CD(+)
  and T_RLSD_PUCH_ODR.PUCH_ODR_CD = T2.PUCH_ODR_CD(+)
  and T_RLSD_PUCH_ODR.UNIT_COST_TYP = T3.VALUE(+)
  and 'UNIT_COST_TYP' = T3.NAME(+)
  and T_RLSD_PUCH_ODR.PUCH_ODR_INST_SLIP_ISS_FLG = T4.VALUE(+)
  and 'PUCH_ODR_INST_SLIP_ISS_FLG' = T4.NAME(+)
  and T_RLSD_PUCH_ODR.PUCH_ODR_STS_TYP = T5.VALUE(+)
  and 'PUCH_ODR_STS_TYP' = T5.NAME(+)
  and T_RLSD_PUCH_ODR.INSPC_CMPLT_FLG = T6.VALUE(+)
  and 'INSPC_CMPLT_FLG' = T6.NAME(+)
  and T_RLSD_PUCH_ODR.SPL_ITEM_TYP = T7.VALUE(+)
  and 'SPL_ITEM_TYP' = T7.NAME(+)
  and T_RLSD_PUCH_ODR.ACPT_INSPC_TYP = T8.VALUE(+)
  and 'ACPT_INSPC_TYP' = T8.NAME(+)
  and T_RLSD_PUCH_ODR.INV_CTRL_FLG = T9.VALUE(+)
  and 'INV_CTRL_FLG' = T9.NAME(+)
  and T_RLSD_PUCH_ODR.NON_NO_ITEM_FLG = T10.VALUE(+)
  and 'NON_NO_ITEM_FLG' = T10.NAME(+)
  and M_ITEM.MRP_ODR_TYP = T11.VALUE(+)
  and 'MRP_ODR_TYP' = T11.NAME(+)
  and T_RLSD_PUCH_ODR.ODR_CANCEL_SLIP_ISS_FLG = T12.VALUE(+)
  and 'ODR_CANCEL_SLIP_ISS_FLG' = T12.NAME(+)
/